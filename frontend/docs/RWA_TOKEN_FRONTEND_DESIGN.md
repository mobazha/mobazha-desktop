# RWA Token 前端修改设计文档

## 1. 概述

本文档描述了在Mobazha平台中支持RWA Token（Real-World Asset Token）交易的前端修改方案。RWA Token采用类似DIGITAL_GOOD的处理流程，卖家上架商品，买家付款购买，卖家发货时通过智能合约充值RWA Token。**已实现价格字段和发货流程**。

## 2. 功能需求

### 2.1 卖家功能
- ✅ 创建RWA Token商品列表（包含价格字段）
- ✅ 指定售卖数量范围和价格
- ✅ 接受买家订单
- ✅ **发货时调用钱包充值RWA Token到智能合约**（已实现）
- ✅ 查看订单详情

### 2.2 买家功能
- ✅ 在卖家商店浏览RWA Token商品
- ✅ 购买RWA Token（类似购买数字商品）
- ✅ 等待卖家发货
- ✅ **收到RWA Token后确认收货**（已实现）
- ✅ 查看订单详情

### 2.3 交易流程（已实现）
- ✅ 卖家创建RWA Token商品（类似DIGITAL_GOOD，包含价格字段）
- ✅ 买家下单并付款（使用现有支付流程）
- ✅ 卖家接受订单
- ✅ **卖家发货时调用后端接口获取充值指令**（已实现）
- ✅ **前端调用钱包执行充值指令，将RWA Token充值到智能合约**（已实现）
- ✅ **买家收到RWA Token后确认收货**（已实现）
- ✅ 交易完成，卖家收到付款

## 3. 前端修改方案

### 3.1 数据模型修改

#### 3.1.1 合约类型扩展
- ✅ 在 `Metadata.js` 中添加 `'RWA_TOKEN'` 合约类型
- ✅ RWA Token使用类似DIGITAL_GOOD的验证逻辑

#### 3.1.2 商品数据结构（已实现）
```javascript
{
  metadata: {
    contractType: 'RWA_TOKEN',
    acceptedCurrencies: ['BTC', 'ETH'], // 支持多种支付币种
    format: 'FIXED_PRICE', // 使用固定价格模式
    pricingCurrency: {
      code: 'USDT', // 商品定价币种
      divisibility: 2
    }
  },
  item: {
    title: '房地产代币',
    price: 1000, // 固定价格（已实现）
    minQuantity: 1, // 最小购买数量
    maxQuantity: 100, // 最大购买数量
    cryptoListingCurrencyCode: 'REAL_ESTATE_001', // 对应rwaTokenMockData中的code字段
    description: '房地产代币描述',
    images: [], // 商品图片
    tags: [], // 商品标签
    categories: [] // 商品分类
  }
}
```

### 3.2 组件修改

#### 3.2.1 商品创建/编辑组件
- **文件**: `EditListing.vue`
- **修改内容**:
  - ✅ RWA Token使用标准商品表单（类似DIGITAL_GOOD）
  - ✅ 添加RWA Token特有字段（合约地址、代币信息等）
  - ✅ 隐藏不相关的字段（变体、库存管理等）

#### 3.2.2 RWA Token编辑组件（已实现）
- **文件**: `RwaTokenType.vue`
- **功能**:
  - ✅ 集成到标准商品表单中
  - ✅ RWA Token信息输入
  - ✅ 代币选择和验证
  - ✅ 区块链选择
  - ✅ **价格字段输入**（新增）
  - ✅ **定价币种选择**（新增）
  - ✅ **动态价格建议**（新增）

#### 3.2.3 商品展示组件
- **文件**: `ListingCard.vue`
- **修改内容**:
  - ✅ 显示RWA Token标识
  - ✅ 使用标准价格显示
  - ✅ **新增RWA Token标识徽章**（新增）
  - ✅ **支持grid和list两种视图**（新增）
  - ✅ **响应式设计适配**（新增）
  - ✅ **右上角定位，不影响布局**（新增）

**ListingCard RWA Token显示功能详细说明**：

1. **RWA Token标识徽章**：
   - 在卡片图片右上角显示"RWA代币"徽章
   - 使用星形图标和紫色主题色
   - 采用毛玻璃效果设计，符合现代化风格
   - 使用绝对定位，不影响现有布局

2. **布局优势**：
   - 徽章位置醒目但不干扰主要信息
   - 不会导致价格、评分等信息超出卡片底部
   - 保持卡片原有高度和宽度

3. **多视图支持**：
   - Grid视图：徽章显示在商品图片右上角
   - List视图：徽章显示在商品图片右上角
   - 响应式设计：移动端自动调整徽章大小

4. **样式设计**：
   - 遵循设计规范，使用半透明背景和毛玻璃效果
   - 颜色搭配：紫色主题色（#6366f1）
   - 定位：`position: absolute; top: 8px; right: 8px;`
   - 字体大小：10px（桌面）/ 9px（移动端）

#### 3.2.4 商品详情组件
- **文件**: `Listing.vue`
- **修改内容**:
  - ✅ RWA Token详细信息展示
  - ✅ 使用标准购买流程
  - ✅ 显示代币风险信息

#### 3.2.5 购买流程组件
- **文件**: `Purchase.vue`
- **修改内容**:
  - ✅ 使用标准购买流程（类似DIGITAL_GOOD）
  - ✅ 数量选择和价格计算
  - ✅ 支付方式选择

#### 3.2.6 订单详情组件
- **文件**: `OrderDetails.vue`
- **修改内容**:
  - ✅ RWA Token订单信息显示
  - ✅ 发货状态跟踪
  - ✅ 代币接收确认

#### 3.2.7 发货流程组件（已实现）
- **文件**: `FulfillOrder.vue`
- **功能**:
  - ✅ 卖家发货时触发RWA Token充值
  - ✅ 调用后端接口获取充值指令
  - ✅ 前端调用钱包执行充值
  - ✅ 更新订单状态
  - ✅ **充值状态实时显示**（新增）
  - ✅ **交易哈希验证**（新增）
  - ✅ **多种区块链支持**（新增）

### 3.3 多语言支持
- **文件**: `zh_CN.json`, `en_US.json`
- **内容**:
  - ✅ RWA Token相关术语翻译
  - ✅ 发货流程相关翻译
  - ✅ 代币验证相关翻译
  - ✅ **充值状态翻译**（新增）
  - ✅ **区块链相关翻译**（新增）

## 4. 技术实现

### 4.1 组件架构（已实现）
```
EditListing.vue
├── 标准商品表单 (类似DIGITAL_GOOD)
│   ├── 标题、描述、图片
│   ├── 价格、数量范围（新增价格字段）
│   └── RwaTokenType.vue (RWA Token特有字段)
└── 其他标准组件...

ListingCard.vue (商品卡片)
├── 标准商品信息
└── RWA Token标识

Listing.vue (商品详情)
├── 标准商品详情
├── RWA Token信息
└── 标准购买按钮

Purchase.vue (购买流程)
└── 标准购买流程 (类似DIGITAL_GOOD)

OrderDetails.vue (订单详情)
├── 标准订单信息
└── RWA Token发货状态

FulfillOrder.vue (发货组件 - 已实现)
└── RWA Token充值流程
```

### 4.2 数据流（已实现）
1. **商品创建**: 用户填写RWA Token信息（包含价格） → 保存商品
2. **商品展示**: 从后台获取RWA Token数据 → 显示商品信息
3. **商品购买**: 用户选择数量 → 标准购买流程 → 创建订单
4. **订单处理**: 卖家接受订单 → 准备发货
5. **发货充值**: 卖家发货 → 调用后端接口 → 获取充值指令 → 执行充值
6. **订单完成**: 买家确认收货 → 交易完成

### 4.3 状态管理
- ✅ 使用Vue的响应式数据管理组件状态
- ✅ 通过props和emit进行父子组件通信
- ✅ 使用Vuex或类似状态管理工具管理全局状态

## 5. 接口设计

### 5.1 后台接口
- `GET /v1/rwa/token-types` - 获取支持的RWA Token类型
- `POST /v1/instructions/rwa/shipment` - 获取RWA Token发货充值指令
- `POST /v1/rwa/shipment` - 处理RWA Token发货完成

### 5.2 前端调用（已实现）
- ✅ 使用现有的订单和支付API
- ✅ 集成钱包插件进行RWA Token充值
- ✅ 处理充值成功/失败回调

## 6. 用户体验设计

### 6.1 界面设计原则
- ✅ 保持与现有DIGITAL_GOOD功能的一致性
- ✅ 清晰显示RWA Token特有信息
- ✅ 简化购买流程，使用标准流程

### 6.2 交互流程（已实现）
1. **卖家创建商品**:
   - ✅ 填写标准商品信息
   - ✅ 添加RWA Token特有信息
   - ✅ 设置价格和库存（新增价格字段）
   - ✅ 保存商品

2. **买家购买商品**:
   - ✅ 浏览RWA Token商品
   - ✅ 选择购买数量
   - ✅ 标准购买流程
   - ✅ 等待卖家发货

3. **卖家发货**:
   - ✅ 接受订单
   - ✅ 发货时触发RWA Token充值
   - ✅ 调用钱包执行充值
   - ✅ 更新订单状态

4. **买家收货**:
   - ✅ 收到RWA Token
   - ✅ 确认收货
   - ✅ 交易完成

## 7. 测试策略

### 7.1 单元测试
- 组件功能测试
- 数据验证测试
- 事件处理测试

### 7.2 集成测试
- 组件间交互测试
- API调用测试
- 钱包集成测试

### 7.3 用户测试
- 界面易用性测试
- 流程完整性测试
- 错误处理测试

## 8. 部署计划

### 8.1 开发阶段（已完成）
1. ✅ 修改现有组件支持RWA Token
2. ✅ 创建发货充值组件
3. ✅ 集成钱包功能
4. ✅ 测试完整流程

### 8.2 测试阶段
1. 单元测试和集成测试
2. 用户界面测试
3. 端到端流程测试

### 8.3 部署阶段
1. 代码审查
2. 生产环境部署
3. 监控和优化

## 9. 风险评估

### 9.1 技术风险
- 钱包集成复杂性
- 智能合约交互风险
- 数据一致性风险

### 9.2 业务风险
- 用户体验接受度
- 交易安全性
- 合规性要求

### 9.3 缓解措施
- 充分的测试和验证
- 渐进式功能发布
- 完善的错误处理机制

## 10. 后续优化

### 10.1 功能扩展
- 支持更多RWA Token类型
- 增加高级交易功能
- 优化用户体验

### 10.2 性能优化
- 组件懒加载
- 数据缓存优化
- 接口响应优化

### 10.3 监控和维护
- 交易监控
- 错误日志分析
- 用户反馈收集

## 11. 实现状态总结

### 11.1 已完成功能
- ✅ RWA Token商品创建（包含价格字段）
- ✅ RWA Token商品展示和购买
- ✅ RWA Token发货流程
- ✅ 智能合约充值功能
- ✅ 多语言支持
- ✅ 数据模型和验证

### 11.2 待完成功能
- 真实的后端API集成
- 真实的钱包集成
- 真实的智能合约调用
- 高级功能（KYC、合规性等）

### 11.3 技术债务
- 需要优化性能
- 需要完善错误处理
- 需要增加测试覆盖率 